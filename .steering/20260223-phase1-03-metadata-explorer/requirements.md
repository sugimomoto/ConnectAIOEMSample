# 要求仕様: Phase 1-03 メタデータエクスプローラー

**作業ディレクトリ**: `.steering/20260223-phase1-03-metadata-explorer/`
**作成日**: 2026-02-23
**関連ドキュメント**: `docs/product-requirements.md` FR-META-001〜006、`docs/functional-design.md` セクション 2.4・5.2・6.1.3

---

## 1. 背景と目的

Phase 1-02 でコネクション管理（作成・一覧・削除）が完成した。
本フェーズでは、作成済みコネクションを通じてデータソースのメタデータ（カタログ・スキーマ・テーブル・カラム）を階層的に探索できる UI と API を実装する。

メタデータエクスプローラーは DataHub の中核機能であり、「コネクション → カタログ → スキーマ → テーブル → カラム」というドリルダウン体験を通じて、パートナーへのデモにおける技術的な差別化要素となる。

---

## 2. ユーザーストーリー

**As a** DataHub のユーザー
**I want to** 接続したデータソースのテーブル構造を視覚的に確認したい
**So that** どのようなデータが利用可能かを素早く把握し、後続のクエリ作成に活用できる

---

## 3. 受け入れ条件

### 3.1 コネクション選択
- [ ] `/explorer` にアクセスすると、自分のコネクション一覧がセレクトボックスに表示される
- [ ] コネクションを選択するとカタログ一覧の取得が開始される

### 3.2 ドリルダウンナビゲーション
- [ ] カタログ一覧が表示され、クリックするとスキーマ一覧が表示される
- [ ] スキーマをクリックするとテーブル一覧が表示される
- [ ] テーブルをクリックするとカラム詳細（名前・データ型・NULL可否）が表示される
- [ ] ブレッドクラム（`コネクション > カタログ > スキーマ > テーブル`）で現在位置が把握できる
- [ ] ブレッドクラムのアイテムをクリックすると上位階層に戻れる

### 3.3 カラム詳細表示
- [ ] テーブル選択時にカラム名、データ型、NULL可否が一覧表示される

### 3.4 テーブル検索・フィルタリング
- [ ] テーブル一覧表示時にテキスト入力でリアルタイムフィルタリングができる

### 3.5 エラー・ローディング
- [ ] 各階層の取得中はローディング表示が出る
- [ ] Connect AI API エラー時はエラーメッセージが表示される
- [ ] コネクションが 0 件の場合は「コネクションがありません。先に作成してください。」メッセージが出る

### 3.6 認証
- [ ] 未ログイン状態でアクセスすると `/login` へリダイレクトされる
- [ ] 各メタデータ API に未認証リクエストすると 401 が返る

---

## 4. 機能要件（対応する FR）

| ID | 要件 | 対応 FR |
|----|------|---------|
| META-01 | カタログ一覧取得・表示 | FR-META-001 |
| META-02 | スキーマ一覧取得・表示 | FR-META-002 |
| META-03 | テーブル一覧取得・表示 | FR-META-003 |
| META-04 | カラム詳細表示（カラム名・データ型・NULL可否） | FR-META-004 |
| META-05 | テーブルの検索・フィルタリング | FR-META-005 |
| META-06 | ブレッドクラム型ナビゲーション | FR-META-006 |

---

## 5. 非機能要件

- **レスポンスタイム**: メタデータ取得 < 3 秒（Connect AI API 依存）
- **セキュリティ**: `@login_required` による認証ガード
- **テナント分離**: 他ユーザーのコネクション ID を指定しても自分のデータのみアクセス可能（Connect AI 側の JWT サブクレームでテナント分離）

---

## 6. スコープ外（今フェーズでは実装しない）

- プライマリキー・外部キーの表示（Phase 2 以降）
- データプレビュー（カラム詳細からのデータ取得）
- 全文検索（カタログ・スキーマ横断）
- ツリービュー（アコーディオン式の全階層同時表示）

---

## 7. 前提・制約

- コネクション管理（Phase 1-02）が完成済みであること
- Connect AI Powered-By メタデータ API のエンドポイント・パラメータは実装時に curl で検証する
  - 参考: `GET /catalogs`, `GET /schemas`, `GET /tables`, `GET /columns`（`connectionId` パラメータ付き）
- フロントエンドは Alpine.js + Tailwind CSS（CDN）で実装し、ビルドステップなし
